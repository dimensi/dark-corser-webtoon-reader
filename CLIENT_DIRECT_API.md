# –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Google Drive API —Å –∫–ª–∏–µ–Ω—Ç–∞

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

### ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:
- **–ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –ö–ª–∏–µ–Ω—Ç –Ω–∞–ø—Ä—è–º—É—é –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ Google Drive API
- **–ú–µ–Ω—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä**: –ü—Ä–æ–∫—Å–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback
- **–õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: –ù–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤
- **–ë–æ–ª–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ**: –¢–æ–∫–µ–Ω—ã –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä

### üîÑ –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1**: –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Google Drive API —Å OAuth —Ç–æ–∫–µ–Ω–æ–º
2. **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2**: –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ø—É–±–ª–∏—á–Ω—ã–º —Å—Å—ã–ª–∫–∞–º Google Drive
3. **Fallback**: –ü—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç)

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### `src/lib/utils/driveApi.ts`
–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Google Drive API:
- `fetchDriveFileWithAuth()` - –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- `fetchDriveFilePublic()` - –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏
- `fetchDriveFile()` - —É–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å fallback
- `DriveApiError` - —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

### `src/lib/components/DriveFileLoader.svelte`
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ —Å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –º–µ–∂–¥—É –º–µ—Ç–æ–¥–∞–º–∏:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –º–µ—Ç–æ–¥–∞
- –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–≥—Ä—É–∑–∫–∏

## üîß –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### `src/lib/components/ArchiveReader.svelte`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `fetchDriveFile()` –≤–º–µ—Å—Ç–æ –ø—Ä–æ–∫—Å–∏
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ DriveApiError

### `src/routes/api/proxy/[id]/+server.ts`
- –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback
- –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –î–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```typescript
// 1. –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Google Drive API
const response = await fetchDriveFile(fileId, accessToken);

// 2. –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å - fallback –Ω–∞ –ø—É–±–ª–∏—á–Ω—É—é —Å—Å—ã–ª–∫—É
// 3. –ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
```

### –î–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```typescript
// 1. –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ –ø—É–±–ª–∏—á–Ω–æ–π —Å—Å—ã–ª–∫–µ Google Drive
const response = await fetchDriveFile(fileId);

// 2. –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç - –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
```

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- **–¢–æ–∫–µ–Ω—ã –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–∞—à —Å–µ—Ä–≤–µ—Ä**
- **–ú–µ–Ω—å—à–µ —Ç–æ—á–µ–∫ –æ—Ç–∫–∞–∑–∞**
- **–ü—Ä—è–º–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å Google API**

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
- **CORS**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –±—Ä–∞—É–∑–µ—Ä—ã –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- **Rate limiting**: Google –º–æ–∂–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å –∫–ª–∏–µ–Ω—Ç–∞
- **–¢–æ–∫–µ–Ω—ã –≤ localStorage**: –ú–µ–Ω–µ–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ, —á–µ–º server-side —Ö—Ä–∞–Ω–µ–Ω–∏–µ

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–∞ –∑–∞–≥—Ä—É–∑–∫–∏:
–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏—è:
- `"Direct API request failed, trying proxy fallback..."`
- `"Auth failed, trying public link"`
- `"Access denied via API, trying public link"`

### –õ–æ–≥–∏ –≤ Network tab:
- **–ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: `https://www.googleapis.com/drive/v3/files/...`
- **–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏**: `https://drive.google.com/uc?export=download&id=...`
- **–ü—Ä–æ–∫—Å–∏**: `/api/proxy/...`

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ú–µ—Ç—Ä–∏–∫–∏:
- **–ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: ~200-500ms
- **–ü—É–±–ª–∏—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏**: ~300-800ms  
- **–ü—Ä–æ–∫—Å–∏**: ~500-1000ms

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Å–∞–º–æ–≥–æ –±—ã—Å—Ç—Ä–æ–≥–æ –º–µ—Ç–æ–¥–∞
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –≤ localStorage
- Lazy loading –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### CORS –æ—à–∏–±–∫–∏:
```
Access to fetch at 'https://www.googleapis.com/drive/v3/files/...' 
from origin 'https://dark-corser-webtoon-reader.vercel.app' 
has been blocked by CORS policy
```
**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –ø—Ä–æ–∫—Å–∏

### Rate limiting:
```
429 Too Many Requests
```
**–†–µ—à–µ–Ω–∏–µ**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ `getErrorMessage()` —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∑–∂–µ

### –ù–µ–≤–µ—Ä–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã:
```
401 Unauthorized
```
**–†–µ—à–µ–Ω–∏–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π fallback –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ —Å—Å—ã–ª–∫–∏

## üîÆ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ IndexedDB
2. **Retry logic**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä—ã –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∞—Ö
3. **–ú–µ—Ç—Ä–∏–∫–∏**: –°–±–æ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –º–µ—Ç–æ–¥–∞–º –∑–∞–≥—Ä—É–∑–∫–∏
4. **Web Workers**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ —Ñ–æ–Ω–µ
