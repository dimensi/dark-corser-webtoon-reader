# Реализация Google OAuth авторизации

## Что было реализовано

### 1. Сервис авторизации (`src/lib/services/googleAuth.ts`)
- Интеграция с Google Identity Services (GIS) JavaScript API
- Управление access token в localStorage
- Подписка на изменения состояния авторизации
- Валидация токенов через Google API

### 2. UI компонент авторизации (`src/lib/components/GoogleAuthButton.svelte`)
- Кнопка "Войти через Google" с иконкой Google
- Отображение статуса авторизации
- Кнопка "Выйти" для завершения сессии
- Адаптивный дизайн для мобильных устройств

### 3. Интеграция в layout (`src/routes/+layout.svelte`)
- Добавлен header с кнопкой авторизации
- Sticky header с backdrop-filter
- Адаптивная верстка

### 4. Обновленный proxy endpoint (`src/routes/api/proxy/[id]/+server.ts`)
- Поддержка Authorization header
- Использование Google Drive API v3 для авторизованных запросов
- Fallback на публичные ссылки при отсутствии авторизации
- Улучшенная обработка ошибок

### 5. Обновленный ArchiveReader (`src/lib/components/ArchiveReader.svelte`)
- Автоматическая передача токена авторизации
- Улучшенные сообщения об ошибках
- Поддержка приватных файлов Google Drive

### 6. Настройка окружения
- Добавлен Google Identity Services script в `app.html`
- Обновлен `.gitignore` для исключения credentials файлов
- Создан файл с примером переменных окружения

## Как это работает

1. **Авторизация**: Пользователь нажимает "Войти через Google" → открывается popup с Google OAuth → получается access token
2. **Хранение**: Access token сохраняется в localStorage
3. **Запросы**: При загрузке файлов из Google Drive токен автоматически передается в Authorization header
4. **API**: Сервер использует Google Drive API v3 для авторизованных запросов
5. **Fallback**: Если авторизация не удалась, используется публичная ссылка

## Преимущества

- **Безопасность**: Токены хранятся только в браузере
- **Удобство**: Автоматическая авторизация для всех запросов
- **Совместимость**: Работает с публичными и приватными файлами
- **UX**: Понятные сообщения об ошибках и статус авторизации

## Требования для работы

1. Настроить Google Cloud Console (см. `GOOGLE_OAUTH_SETUP.md`)
2. Создать файл `.env` с `PUBLIC_GOOGLE_CLIENT_ID`
3. Запустить приложение: `npm run dev`

## Тестирование

1. Откройте `http://localhost:5173`
2. Нажмите "Войти через Google"
3. Авторизуйтесь в Google
4. Попробуйте открыть файл из Google Drive
5. Проверьте, что приватные файлы теперь доступны
